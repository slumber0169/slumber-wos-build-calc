<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8" />
<title>建築コスト＆建造時間シミュレーター</title>
<style>
  :root {
    --bg: #050b14;
    --card: #111c2b;
    --card-soft: #152337;
    --accent: #7fd3ff;
    --accent-soft: #3b7fa7;
    --text: #e6f7ff;
    --muted: #9fb4c9;
    --danger: #ff6b81;
  }
  * { box-sizing: border-box; }
  body {
    margin: 0;
    padding: 24px;
    font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
    background: radial-gradient(circle at top, #0f243a, #050b14);
    color: var(--text);
  }
  h1 { font-size: 24px; margin: 0 0 12px; }
  h2 { font-size: 18px; margin: 20px 0 8px; }
  .container { max-width: 960px; margin: 0 auto; }
  .card {
    background: var(--card);
    border-radius: 16px;
    padding: 20px;
    box-shadow: 0 18px 40px rgba(0,0,0,0.6);
    border: 1px solid rgba(127,211,255,0.2);
  }
  .subtitle {
    color: var(--muted);
    font-size: 13px;
    margin-bottom: 16px;
  }
  table { width: 100%; border-collapse: collapse; margin-top: 4px; }
  th, td {
    padding: 6px 4px;
    font-size: 13px;
    text-align: center;
  }
  th {
    color: var(--muted);
    border-bottom: 1px solid rgba(255,255,255,0.06);
  }
  tr:nth-child(even) td { background: rgba(255,255,255,0.01); }
  label { font-size: 13px; }
  input[type="number"], select {
    width: 80px;
    padding: 4px 6px;
    border-radius: 8px;
    border: 1px solid rgba(127,211,255,0.3);
    background: var(--card-soft);
    color: var(--text);
    font-size: 13px;
  }
  select.wide { width: 100px; }
  input[type="number"]:focus, select:focus {
    outline: 2px solid var(--accent);
    outline-offset: 1px;
  }
  .controls {
    display: flex;
    flex-wrap: wrap;
    gap: 12px 20px;
    margin-top: 12px;
    padding: 12px;
    border-radius: 12px;
    background: linear-gradient(135deg, rgba(127,211,255,0.12), rgba(5,11,20,0.9));
  }
  .control-group {
    display: flex;
    flex-direction: column;
    gap: 4px;
  }
  .control-note {
    font-size: 11px;
    color: var(--muted);
    max-width: 520px;
    line-height: 1.4;
  }
  .radio-row {
    display: flex;
    gap: 10px;
    align-items: center;
  }
  .radio-row label {
    display: flex;
    gap: 4px;
    align-items: center;
  }
  button {
    border: none;
    border-radius: 999px;
    padding: 10px 22px;
    font-size: 14px;
    font-weight: 600;
    cursor: pointer;
    background: linear-gradient(135deg, var(--accent), #b8ecff);
    color: #06101a;
    box-shadow: 0 10px 25px rgba(127,211,255,0.5);
    transition: transform 0.1s ease, box-shadow 0.1s ease;
  }
  button:hover {
    transform: translateY(-1px);
    box-shadow: 0 16px 32px rgba(127,211,255,0.6);
  }
  button:active {
    transform: translateY(0);
    box-shadow: 0 8px 18px rgba(127,211,255,0.4);
  }
  .btn-row {
    margin-top: 12px;
    display: flex;
    justify-content: flex-end;
  }
  .results {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
    gap: 10px;
    margin-top: 16px;
  }
  .result-card {
    background: var(--card-soft);
    border-radius: 12px;
    padding: 10px 12px;
    border: 1px solid rgba(127,211,255,0.2);
    font-size: 13px;
  }
  .result-label {
    color: var(--muted);
    font-size: 12px;
    margin-bottom: 4px;
  }
  .result-value {
    font-size: 16px;
    font-weight: 600;
  }
  .detail-table { margin-top: 8px; font-size: 12px; }
  .detail-table th, .detail-table td { font-size: 12px; }
  .note {
    margin-top: 10px;
    font-size: 11px;
    color: var(--muted);
    line-height: 1.5;
  }
  @media (max-width: 640px) {
    body { padding: 12px; }
    .card { padding: 14px; }
    table { font-size: 12px; }
    input[type="number"], select { width: 72px; font-size: 12px; }
  }
</style>
</head>
<body>
<div class="container">
  <div class="card">
    <h1>建築コスト＆建造時間シミュレーター</h1>
    <div class="subtitle">
      各建物の「現在FC-段階」と「目標FC-段階」を入れると、<br>
      必要な精錬火晶・火晶と、加速後の建造時間合計を計算します。<br>
    </div>

    <h2>① 建物ごとのレベル</h2>
    <table>
      <thead>
        <tr>
          <th>建物</th>
          <th>現在 FC-段階</th>
          <th>目標 FC-段階</th>
        </tr>
      </thead>
      <tbody id="buildingRows">
        <tr data-building="大溶鉱炉">
          <td>大溶鉱炉</td>
          <td>
            FC
            <select class="from-fc"></select>
            -
            <select class="from-stage"></select>
          </td>
          <td>
            FC
            <select class="to-fc"></select>
            -
            <select class="to-stage"></select>
          </td>
        </tr>
        <tr data-building="大使館">
          <td>大使館</td>
          <td>
            FC
            <select class="from-fc"></select>
            -
            <select class="from-stage"></select>
          </td>
          <td>
            FC
            <select class="to-fc"></select>
            -
            <select class="to-stage"></select>
          </td>
        </tr>
        <tr data-building="盾兵舎">
          <td>盾兵舎</td>
          <td>
            FC
            <select class="from-fc"></select>
            -
            <select class="from-stage"></select>
          </td>
          <td>
            FC
            <select class="to-fc"></select>
            -
            <select class="to-stage"></select>
          </td>
        </tr>
        <tr data-building="槍兵舎">
          <td>槍兵舎</td>
          <td>
            FC
            <select class="from-fc"></select>
            -
            <select class="from-stage"></select>
          </td>
          <td>
            FC
            <select class="to-fc"></select>
            -
            <select class="to-stage"></select>
          </td>
        </tr>
        <tr data-building="弓兵舎">
          <td>弓兵舎</td>
          <td>
            FC
            <select class="from-fc"></select>
            -
            <select class="from-stage"></select>
          </td>
          <td>
            FC
            <select class="to-fc"></select>
            -
            <select class="to-stage"></select>
          </td>
        </tr>
        <tr data-building="司令部">
          <td>司令部</td>
          <td>
            FC
            <select class="from-fc"></select>
            -
            <select class="from-stage"></select>
          </td>
          <td>
            FC
            <select class="to-fc"></select>
            -
            <select class="to-stage"></select>
          </td>
        </tr>
        <tr data-building="戦争学園">
          <td>戦争学園</td>
          <td>
            FC
            <select class="from-fc"></select>
            -
            <select class="from-stage"></select>
          </td>
          <td>
            FC
            <select class="to-fc"></select>
            -
            <select class="to-stage"></select>
          </td>
        </tr>
      </tbody>
    </table>

    <h2>② 加速設定</h2>
    <div class="accel-note control-note">
      ジンマンは上げたタイミングで建造加速に自動で入っているので、ここでは特に気にしなくて大丈夫です。<br>
      建造加速確認方法：左上の自分の戦力 → 一番下までスクロール → 下から三つ目の「建造速度」で確認できます。<br>
    </div>
    <div class="controls">
      <div class="control-group">
        <label>建造加速（％）</label>
        <input id="baseAccel" type="number" value="0" min="0" step="1" />
      </div>
      <div class="control-group">
        <label>領主指令</label>
        <div class="radio-row">
          <label><input type="radio" name="lord" value="off" checked /> なし</label>
          <label><input type="radio" name="lord" value="on" /> あり（+20％）</label>
        </div>
      </div>
      <div class="control-group">
        <label>ペットスキル Lv</label>
        <select id="petLevel" class="wide">
          <option value="0">Lv0（なし）</option>
          <option value="1">Lv1（+5％）</option>
          <option value="2">Lv2（+7％）</option>
          <option value="3">Lv3（+9％）</option>
          <option value="4">Lv4（+12％）</option>
          <option value="5">Lv5（+15％）</option>
        </select>
      </div>
      <div class="control-group">
        <label>執政官スキル</label>
        <div class="radio-row">
          <label><input type="radio" name="governor" value="off" checked> なし</label>
          <label><input type="radio" name="governor" value="on"> あり（+10％）</label>
        </div>
      </div>
      <div class="control-group">
        <label>副執政官スキル</label>
        <select id="subGov" class="wide">
          <option value="0">なし</option>
          <option value="10">あり（通常時 +10％）</option>
          <option value="15">あり（至高時 +15％）</option>
        </select>
      </div>
      <div class="control-group">
        <label>アグネススキル Lv</label>
        <select id="agnesLevel" class="wide">
          <option value="0">Lv0（なし）</option>
          <option value="1">Lv1（1段階あたり2時間）</option>
          <option value="2">Lv2（1段階あたり3時間）</option>
          <option value="3">Lv3（1段階あたり4時間）</option>
          <option value="4">Lv4（1段階あたり6時間）</option>
          <option value="5">Lv5（1段階あたり8時間）</option>
        </select>
      </div>
    </div>

    <div class="btn-row">
      <button id="calcBtn">計算する</button>
    </div>

    <h2>③ 結果</h2>
    <div class="results">
      <div class="result-card">
        <div class="result-label">総精錬火晶</div>
        <div class="result-value" id="totalRefine">-</div>
      </div>
      <div class="result-card">
        <div class="result-label">総火晶</div>
        <div class="result-value" id="totalFire">-</div>
      </div>
      <div class="result-card">
        <div class="result-label">基礎建造時間 合計</div>
        <div class="result-value" id="baseTime">-</div>
      </div>
      <div class="result-card">
        <div class="result-label">加速後 建造時間 合計</div>
        <div class="result-value" id="boostedTime">-</div>
      </div>
      <div class="result-card">
        <div class="result-label">合計加速率（％加速分）</div>
        <div class="result-value" id="accelInfo">-</div>
      </div>
    </div>

    <h2>④ 建物別 内訳</h2>
    <table class="detail-table">
      <thead>
        <tr>
          <th>建物</th>
          <th>精錬火晶</th>
          <th>火晶</th>
          <th>基礎時間</th>
          <th>加速後時間（％＋アグネス）</th>
        </tr>
      </thead>
      <tbody id="detailBody">
        <tr><td colspan="5" style="color:var(--muted);">まだ計算していません。</td></tr>
      </tbody>
    </table>

    <div class="note">
      ※ 時間は、各段階ごとの「基礎建造時間」を合計し、<br>
      (100 ＋ 建造加速 ＋ 領主指令 ＋ ペットスキル ＋ 執政官 ＋ 副執政官)％ で割合加速したあと、<br>
      アグネススキルLvに応じて「1段階あたりの固定短縮時間 × 上げた段階数」を段階ごとに減算して計算しています。<br>
    </div>
  </div>
</div>

<script>
const STAGES_PER_FC = 5;

function buildDaikou() {
  const rows = [];
  const push = (fc,sf,st,refine,fire,d,h,m,s) => {
    for (let stage = sf; stage <= st; stage++) {
      rows.push({fc, stage, refine, fire, d, h, m, s});
    }
  };
  push(0,0,4,0,132,7,0,0,0);
  push(1,0,4,0,158,9,0,0,0);
  push(2,0,4,0,238,11,0,0,0);
  push(3,0,4,0,280,12,0,0,0);
  push(4,0,4,0,335,14,0,0,0);
  push(5,0,3,10,200,15,0,0,0);
  push(5,4,4,20,100,15,0,0,0);
  push(6,0,3,15,240,18,0,0,0);
  push(6,4,4,30,120,18,0,0,0);
  push(7,0,3,20,240,20,0,0,0);
  push(7,4,4,40,120,20,0,0,0);
  return rows;
}

function buildTaishikan() {
  const rows = [];
  const push = (fc,sf,st,refine,fire,d,h,m,s) => {
    for (let stage = sf; stage <= st; stage++) {
      rows.push({fc, stage, refine, fire, d, h, m, s});
    }
  };
  push(0,0,4,0,33,4,14,52,0);
  push(1,0,4,0,39,5,22,33,0);
  push(2,0,4,0,59,7,6,14,0);
  push(3,0,4,0,70,7,22,4,0);
  push(4,0,4,0,83,9,5,45,0);
  push(5,0,3,2,50,9,21,36,0);
  push(5,4,4,5,25,9,21,36,0);
  push(6,0,3,3,60,11,21,7,0);
  push(6,4,4,7,30,11,21,7,0);
  push(7,0,3,5,60,13,4,48,0);
  push(7,4,4,11,30,13,4,48,0);
  return rows;
}

function buildShireibu() {
  const rows = [];
  const push = (fc,sf,st,refine,fire,d,h,m,s) => {
    for (let stage = sf; stage <= st; stage++) {
      rows.push({fc, stage, refine, fire, d, h, m, s});
    }
  };
  push(0,0,4,0,26,0,20,9,30);
  push(1,0,4,0,31,1,1,55,0);
  push(2,0,4,0,47,1,7,40,0);
  push(3,0,4,0,56,1,10,33,0);
  push(4,0,4,0,67,1,16,31,0);
  push(5,0,3,2,40,1,19,12,0);
  push(5,4,4,4,20,1,19,12,0);
  push(6,0,3,3,48,2,1,30,0);
  push(6,4,4,6,24,2,1,30,0);
  push(7,0,3,4,48,2,9,36,0);
  push(7,4,4,8,24,2,9,36,0);
  return rows;
}

function buildHeisha() {
  const rows = [];
  const push = (fc,sf,st,refine,fire,d,h,m,s) => {
    for (let stage = sf; stage <= st; stage++) {
      rows.push({fc, stage, refine, fire, d, h, m, s});
    }
  };
  push(0,0,4,0,59,1,1,12,0);
  push(1,0,4,0,71,1,8,24,0);
  push(2,0,4,0,107,1,15,36,0);
  push(3,0,4,0,126,1,19,12,0);
  push(4,0,4,0,150,2,2,24,0);
  push(5,0,3,4,90,2,6,0,0);
  push(5,4,4,9,45,2,6,0,0);
  push(6,0,3,6,108,2,16,48,0);
  push(6,4,4,13,54,2,16,48,0);
  push(7,0,3,9,108,3,0,0,0);
  push(7,4,4,18,54,3,0,0,0);
  return rows;
}

function buildGakuen() {
  const rows = [];
  const push = (fc,sf,st,refine,fire,d,h,m,s) => {
    for (let stage = sf; stage <= st; stage++) {
      rows.push({fc, stage, refine, fire, d, h, m, s});
    }
  };
  push(0,0,4,0,0,0,0,0,0);
  push(1,0,4,0,71,1,19,12,0);
  push(2,0,4,0,107,2,4,48,0);
  push(3,0,4,0,126,2,9,36,0);
  push(4,0,4,0,150,2,19,12,0);
  push(5,0,3,4,90,3,0,0,0);
  push(5,4,4,9,45,3,0,0,0);
  push(6,0,3,6,108,3,14,24,0);
  push(6,4,4,13,54,3,14,24,0);
  push(7,0,4,9,108,4,0,0,0);
  return rows;
}

const BASE_DATA = {
  "大溶鉱炉": buildDaikou(),
  "大使館": buildTaishikan(),
  "司令部": buildShireibu(),
  "兵舎": buildHeisha(),
  "戦争学園": buildGakuen(),
};

function idxFromFcStage(fc, stage) {
  return fc * STAGES_PER_FC + stage;
}

function rowToSeconds(row) {
  return (((row.d * 24 + row.h) * 60 + row.m) * 60 + row.s);
}

function secondsToText(sec) {
  if (sec <= 0) return "0秒";
  const days = Math.floor(sec / 86400);
  sec %= 86400;
  const hours = Math.floor(sec / 3600);
  sec %= 3600;
  const mins = Math.floor(sec / 60);
  const secs = sec % 60;
  let parts = [];
  if (days) parts.push(days + "日");
  if (hours || parts.length) parts.push(hours + "時間");
  if (mins || parts.length) parts.push(mins + "分");
  if (secs || parts.length === 0) parts.push(secs + "秒");
  return parts.join(" ");
}

function getPetBonus(level) {
  switch (level) {
    case 1: return 5;
    case 2: return 7;
    case 3: return 9;
    case 4: return 12;
    case 5: return 15;
    default: return 0;
  }
}

function getAgnesBonusHours(level) {
  switch (level) {
    case 1: return 2;
    case 2: return 3;
    case 3: return 4;
    case 4: return 6;
    case 5: return 8;
    default: return 0;
  }
}

// 建物ごとの集計（％加速＋アグネス込み）
function calcBuilding(buildingName, fromFc, fromStage, toFc, toStage, totalAccelPercent, agnesLevel) {
  const dataKey = buildingName.includes("兵舎") ? "兵舎" : buildingName;
  const data = BASE_DATA[dataKey];
  if (!data) return { refine: 0, fire: 0, baseSec: 0, finalSec: 0 };

  const startIdx = idxFromFcStage(fromFc, fromStage);
  const endIdx = idxFromFcStage(toFc, toStage);

  if (endIdx <= startIdx) {
    return { refine: 0, fire: 0, baseSec: 0, finalSec: 0 };
  }

  const maxIdx = Math.min(endIdx, data.length);
  const agnesHours = getAgnesBonusHours(agnesLevel);
  const agnesCutPerStepSec = agnesHours * 3600;

  let refine = 0;
  let fire = 0;
  let baseSec = 0;
  let finalSec = 0;

  for (let i = startIdx; i < maxIdx; i++) {
    const row = data[i];
    const stepBase = rowToSeconds(row);

    refine += row.refine;
    fire += row.fire;
    baseSec += stepBase;

    // 割合加速後
    let stepAfterPercent = totalAccelPercent > 0
      ? Math.floor(stepBase * 100 / (100 + totalAccelPercent))
      : stepBase;

    // アグネス固定短縮（1段階ごと）
    if (agnesCutPerStepSec > 0) {
      stepAfterPercent = Math.max(0, stepAfterPercent - agnesCutPerStepSec);
    }

    finalSec += stepAfterPercent;
  }

  return { refine, fire, baseSec, finalSec };
}

(function initSelectors() {
  const fcOptions = [];
  for (let fc = 0; fc <= 8; fc++) {
    fcOptions.push(`<option value="${fc}">${fc}</option>`);
  }
  const stageOptions = [];
  for (let st = 0; st <= 4; st++) {
    stageOptions.push(`<option value="${st}">${st}</option>`);
  }

  document.querySelectorAll("#buildingRows tr").forEach((tr) => {
    tr.querySelectorAll(".from-fc, .to-fc").forEach(sel => {
      sel.innerHTML = fcOptions.join("");
    });
    tr.querySelectorAll(".from-stage, .to-stage").forEach(sel => {
      sel.innerHTML = stageOptions.join("");
    });
  });
})();

document.getElementById("calcBtn").addEventListener("click", () => {
  const tbody = document.getElementById("detailBody");
  tbody.innerHTML = "";

  let totalRefine = 0;
  let totalFire = 0;
  let totalBaseSec = 0;
  let totalFinalSec = 0;

  const baseAccel = Number(document.getElementById("baseAccel").value) || 0;
  const lordRadio = document.querySelector("input[name='lord']:checked");
  const lordBonus = lordRadio && lordRadio.value === "on" ? 20 : 0;
  const petLevel = Number(document.getElementById("petLevel").value) || 0;
  const petBonus = getPetBonus(petLevel);
  const govRadio = document.querySelector("input[name='governor']:checked");
  const govBonus = govRadio && govRadio.value === "on" ? 10 : 0;
  const subGovBonus = Number(document.getElementById("subGov").value) || 0;
  const agnesLevel = Number(document.getElementById("agnesLevel").value) || 0;

  const totalAccelPercent = baseAccel + lordBonus + petBonus + govBonus + subGovBonus;

  const rows = document.querySelectorAll("#buildingRows tr");
  const detailRows = [];

  rows.forEach((tr) => {
    const name = tr.dataset.building;
    const fromFc = Number(tr.querySelector(".from-fc").value);
    const fromStage = Number(tr.querySelector(".from-stage").value);
    const toFc = Number(tr.querySelector(".to-fc").value);
    const toStage = Number(tr.querySelector(".to-stage").value);

    const { refine, fire, baseSec, finalSec } =
      calcBuilding(name, fromFc, fromStage, toFc, toStage, totalAccelPercent, agnesLevel);

    if (baseSec > 0 || refine > 0 || fire > 0) {
      totalRefine += refine;
      totalFire += fire;
      totalBaseSec += baseSec;
      totalFinalSec += finalSec;

      detailRows.push(`
        <tr>
          <td>${name}</td>
          <td>${refine}</td>
          <td>${fire}</td>
          <td>${secondsToText(baseSec)}</td>
          <td>${secondsToText(finalSec)}</td>
        </tr>
      `);
    }
  });

  if (detailRows.length === 0) {
    tbody.innerHTML = `<tr><td colspan="5" style="color:var(--muted);">有効なレベル差がありません。（現在と目標が同じ）</td></tr>`;
  } else {
    tbody.innerHTML = detailRows.join("");
  }

  document.getElementById("totalRefine").textContent = totalRefine.toLocaleString();
  document.getElementById("totalFire").textContent = totalFire.toLocaleString();
  document.getElementById("baseTime").textContent = secondsToText(totalBaseSec);
  document.getElementById("boostedTime").textContent = secondsToText(totalFinalSec);
  document.getElementById("accelInfo").textContent =
    `${totalAccelPercent}%（建造${baseAccel}% ＋ 領主${lordBonus}% ＋ ペット${petBonus}% ＋ 執政官${govBonus}% ＋ 副執政官${subGovBonus}%）`;
});
</script>
</body>
</html>
