<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8" />
<title>å»ºç¯‰ã‚³ã‚¹ãƒˆï¼†å»ºé€ æ™‚é–“ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼</title>
<style>
  :root {
    --bg: #050b14;
    --card: #111c2b;
    --card-soft: #152337;
    --accent: #7fd3ff;
    --accent-soft: #3b7fa7;
    --text: #e6f7ff;
    --muted: #9fb4c9;
    --danger: #ff6b81;
  }
  * { box-sizing: border-box; }
  body {
    margin: 0;
    padding: 24px;
    font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
    background: radial-gradient(circle at top, #0f243a, #050b14);
    color: var(--text);
  }
  h1 { font-size: 24px; margin: 0 0 12px; }
  h2 { font-size: 18px; margin: 20px 0 8px; }
  .container { max-width: 960px; margin: 0 auto; }
  .card {
    background: var(--card);
    border-radius: 16px;
    padding: 20px;
    box-shadow: 0 18px 40px rgba(0,0,0,0.6);
    border: 1px solid rgba(127,211,255,0.2);
  }
  .subtitle {
    color: var(--muted);
    font-size: 13px;
    margin-bottom: 16px;
  }
  table { width: 100%; border-collapse: collapse; margin-top: 4px; }
  th, td {
    padding: 6px 4px;
    font-size: 13px;
    text-align: center;
  }
  th {
    color: var(--muted);
    border-bottom: 1px solid rgba(255,255,255,0.06);
  }
  tr:nth-child(even) td { background: rgba(255,255,255,0.01); }
  label { font-size: 13px; }
  input[type="number"], select {
    width: 80px;
    padding: 4px 6px;
    border-radius: 8px;
    border: 1px solid rgba(127,211,255,0.3);
    background: var(--card-soft);
    color: var(--text);
    font-size: 13px;
  }
  select.wide { width: 100px; }
  input[type="number"]:focus, select:focus {
    outline: 2px solid var(--accent);
    outline-offset: 1px;
  }
  .controls {
    display: flex;
    flex-wrap: wrap;
    gap: 12px 20px;
    margin-top: 12px;
    padding: 12px;
    border-radius: 12px;
    background: linear-gradient(135deg, rgba(127,211,255,0.12), rgba(5,11,20,0.9));
  }
  .control-group {
    display: flex;
    flex-direction: column;
    gap: 4px;
  }
  .control-note {
    font-size: 11px;
    color: var(--muted);
    max-width: 520px;
    line-height: 1.4;
  }
  .radio-row {
    display: flex;
    gap: 10px;
    align-items: center;
  }
  .radio-row label {
    display: flex;
    gap: 4px;
    align-items: center;
  }
  button {
    border: none;
    border-radius: 999px;
    padding: 10px 22px;
    font-size: 14px;
    font-weight: 600;
    cursor: pointer;
    background: linear-gradient(135deg, var(--accent), #b8ecff);
    color: #06101a;
    box-shadow: 0 10px 25px rgba(127,211,255,0.5);
    transition: transform 0.1s ease, box-shadow 0.1s ease;
  }
  button:hover {
    transform: translateY(-1px);
    box-shadow: 0 16px 32px rgba(127,211,255,0.6);
  }
  button:active {
    transform: translateY(0);
    box-shadow: 0 8px 18px rgba(127,211,255,0.4);
  }
  .btn-row {
    margin-top: 12px;
    display: flex;
    justify-content: flex-end;
  }
  .results {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
    gap: 10px;
    margin-top: 16px;
  }
  .result-card {
    background: var(--card-soft);
    border-radius: 12px;
    padding: 10px 12px;
    border: 1px solid rgba(127,211,255,0.2);
    font-size: 13px;
  }
  .result-label {
    color: var(--muted);
    font-size: 12px;
    margin-bottom: 4px;
  }
  .result-value {
    font-size: 16px;
    font-weight: 600;
  }
  .detail-table { margin-top: 8px; font-size: 12px; }
  .detail-table th, .detail-table td { font-size: 12px; }
  .note {
    margin-top: 10px;
    font-size: 11px;
    color: var(--muted);
    line-height: 1.5;
  }
  @media (max-width: 640px) {
    body { padding: 12px; }
    .card { padding: 14px; }
    table { font-size: 12px; }
    input[type="number"], select { width: 72px; font-size: 12px; }
  }
  /* ======== ã‚¹ãƒãƒ›å°‚ç”¨ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ ======== */
@media (max-width: 640px) {

  /* å…¨ä½“ã‚«ãƒ¼ãƒ‰ã®ä½™ç™½ã‚’èª¿æ•´ã—ã¦æ¨ªã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«é˜²æ­¢ */
  .card {
    padding: 14px;
    width: 100%;
    overflow-x: hidden;
  }

  /* ã‚¿ã‚¤ãƒˆãƒ«ä¸‹ã®èª¬æ˜æ–‡ */
  .subtitle {
    font-size: 12px;
    line-height: 1.5;
  }

  /* å»ºç‰©ã®ãƒ†ãƒ¼ãƒ–ãƒ«ã‚’ 1 ã‚«ãƒ©ãƒ åŒ– */
  table thead {
    display: none; /* è¦‹å‡ºã—ã‚’éè¡¨ç¤ºã«ã—ã¦ç¸¦ãƒªã‚¹ãƒˆã« */
  }

  #buildingRows tr {
    display: flex;
    flex-direction: column;
    align-items: flex-start;
    padding: 12px 0;
    border-bottom: 1px solid rgba(255,255,255,0.1);
  }

  #buildingRows td {
    text-align: left;
    font-size: 13px;
    padding: 4px 0;
  }

  /* FC-æ®µéšã®é¸æŠè‚¢ã‚’æ¨ªè©°ã‚ */
  #buildingRows select {
    width: 74px;
  }

  /* åŠ é€Ÿè¨­å®š å…¨ä½“ã‚’1ã‚«ãƒ©ãƒ ã« */
  .controls {
    display: flex;
    flex-direction: column;
    gap: 18px;
    padding: 12px;
  }

  .control-group {
    width: 100%;
  }

  /* åŠ é€Ÿè¨­å®šã®æ³¨é‡ˆã‚’å¹…ã„ã£ã±ã„ã« */
  .control-note {
    max-width: 100%;
    font-size: 11px;
    line-height: 1.5;
  }

  /* ğŸ”¥è¨ˆç®—ãƒœã‚¿ãƒ³ã‚’ç”»é¢ä¸­å¤®ã¸ */
  .btn-row {
    justify-content: center;
    margin-top: 20px;
  }

  button {
    width: 80%;
    max-width: 260px;
    font-size: 15px;
    padding: 12px 0;
  }

  /* çµæœã‚«ãƒ¼ãƒ‰ã‚’1åˆ—ã« */
  .results {
    grid-template-columns: 1fr;
    gap: 12px;
  }

  /* å†…è¨³ãƒ†ãƒ¼ãƒ–ãƒ«ã‚‚ç¸¦æ–¹å‘ã«èª­ã¿ã‚„ã™ã */
  .detail-table th,
  .detail-table td {
    font-size: 11px;
    padding: 6px 4px;
  }
}
</style>
</head>
<body>
<div class="container">
  <div class="card">
    <h1>å»ºç¯‰ã‚³ã‚¹ãƒˆï¼†å»ºé€ æ™‚é–“ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼</h1>
    <div class="subtitle">
      å„å»ºç‰©ã®ã€Œç¾åœ¨FC-æ®µéšã€ã¨ã€Œç›®æ¨™FC-æ®µéšã€ã‚’å…¥ã‚Œã‚‹ã¨ã€<br>
      å¿…è¦ãªç²¾éŒ¬ç«æ™¶ãƒ»ç«æ™¶ã¨ã€åŠ é€Ÿå¾Œã®å»ºé€ æ™‚é–“åˆè¨ˆã‚’è¨ˆç®—ã—ã¾ã™ã€‚<br>
    </div>

    <h2>â‘  å»ºç‰©ã”ã¨ã®ãƒ¬ãƒ™ãƒ«</h2>
    <table>
      <thead>
        <tr>
          <th>å»ºç‰©</th>
          <th>ç¾åœ¨ FC-æ®µéš</th>
          <th>ç›®æ¨™ FC-æ®µéš</th>
        </tr>
      </thead>
      <tbody id="buildingRows">
        <tr data-building="å¤§æº¶é‰±ç‚‰">
          <td>å¤§æº¶é‰±ç‚‰</td>
          <td>
            FC
            <select class="from-fc"></select>
            -
            <select class="from-stage"></select>
          </td>
          <td>
            FC
            <select class="to-fc"></select>
            -
            <select class="to-stage"></select>
          </td>
        </tr>
        <tr data-building="å¤§ä½¿é¤¨">
          <td>å¤§ä½¿é¤¨</td>
          <td>
            FC
            <select class="from-fc"></select>
            -
            <select class="from-stage"></select>
          </td>
          <td>
            FC
            <select class="to-fc"></select>
            -
            <select class="to-stage"></select>
          </td>
        </tr>
        <tr data-building="ç›¾å…µèˆ">
          <td>ç›¾å…µèˆ</td>
          <td>
            FC
            <select class="from-fc"></select>
            -
            <select class="from-stage"></select>
          </td>
          <td>
            FC
            <select class="to-fc"></select>
            -
            <select class="to-stage"></select>
          </td>
        </tr>
        <tr data-building="æ§å…µèˆ">
          <td>æ§å…µèˆ</td>
          <td>
            FC
            <select class="from-fc"></select>
            -
            <select class="from-stage"></select>
          </td>
          <td>
            FC
            <select class="to-fc"></select>
            -
            <select class="to-stage"></select>
          </td>
        </tr>
        <tr data-building="å¼“å…µèˆ">
          <td>å¼“å…µèˆ</td>
          <td>
            FC
            <select class="from-fc"></select>
            -
            <select class="from-stage"></select>
          </td>
          <td>
            FC
            <select class="to-fc"></select>
            -
            <select class="to-stage"></select>
          </td>
        </tr>
        <tr data-building="å¸ä»¤éƒ¨">
          <td>å¸ä»¤éƒ¨</td>
          <td>
            FC
            <select class="from-fc"></select>
            -
            <select class="from-stage"></select>
          </td>
          <td>
            FC
            <select class="to-fc"></select>
            -
            <select class="to-stage"></select>
          </td>
        </tr>
        <tr data-building="æˆ¦äº‰å­¦åœ’">
          <td>æˆ¦äº‰å­¦åœ’</td>
          <td>
            FC
            <select class="from-fc"></select>
            -
            <select class="from-stage"></select>
          </td>
          <td>
            FC
            <select class="to-fc"></select>
            -
            <select class="to-stage"></select>
          </td>
        </tr>
      </tbody>
    </table>

    <h2>â‘¡ åŠ é€Ÿè¨­å®š</h2>
    <div class="accel-note control-note">
      ã‚¸ãƒ³ãƒãƒ³ã¯ä¸Šã’ãŸã‚¿ã‚¤ãƒŸãƒ³ã‚°ã§å»ºé€ åŠ é€Ÿã«è‡ªå‹•ã§å…¥ã£ã¦ã„ã‚‹ã®ã§ã€ã“ã“ã§ã¯ç‰¹ã«æ°—ã«ã—ãªãã¦å¤§ä¸ˆå¤«ã§ã™ã€‚<br>
      å»ºé€ åŠ é€Ÿç¢ºèªæ–¹æ³•ï¼šå·¦ä¸Šã®è‡ªåˆ†ã®æˆ¦åŠ› â†’ ä¸€ç•ªä¸‹ã¾ã§ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ« â†’ ä¸‹ã‹ã‚‰ä¸‰ã¤ç›®ã®ã€Œå»ºé€ é€Ÿåº¦ã€ã§ç¢ºèªã§ãã¾ã™ã€‚<br>
    </div>
    <div class="controls">
      <div class="control-group">
        <label>å»ºé€ åŠ é€Ÿï¼ˆï¼…ï¼‰</label>
        <input id="baseAccel" type="number" value="0" min="0" step="1" />
      </div>
      <div class="control-group">
        <label>é ˜ä¸»æŒ‡ä»¤</label>
        <div class="radio-row">
          <label><input type="radio" name="lord" value="off" checked /> ãªã—</label>
          <label><input type="radio" name="lord" value="on" /> ã‚ã‚Šï¼ˆ+20ï¼…ï¼‰</label>
        </div>
      </div>
      <div class="control-group">
        <label>ãƒšãƒƒãƒˆã‚¹ã‚­ãƒ« Lv</label>
        <select id="petLevel" class="wide">
          <option value="0">Lv0ï¼ˆãªã—ï¼‰</option>
          <option value="1">Lv1ï¼ˆ+5ï¼…ï¼‰</option>
          <option value="2">Lv2ï¼ˆ+7ï¼…ï¼‰</option>
          <option value="3">Lv3ï¼ˆ+9ï¼…ï¼‰</option>
          <option value="4">Lv4ï¼ˆ+12ï¼…ï¼‰</option>
          <option value="5">Lv5ï¼ˆ+15ï¼…ï¼‰</option>
        </select>
      </div>
      <div class="control-group">
        <label>åŸ·æ”¿å®˜ã‚¹ã‚­ãƒ«</label>
        <div class="radio-row">
          <label><input type="radio" name="governor" value="off" checked> ãªã—</label>
          <label><input type="radio" name="governor" value="on"> ã‚ã‚Šï¼ˆ+10ï¼…ï¼‰</label>
        </div>
      </div>
      <div class="control-group">
        <label>å‰¯åŸ·æ”¿å®˜ã‚¹ã‚­ãƒ«</label>
        <select id="subGov" class="wide">
          <option value="0">ãªã—</option>
          <option value="10">ã‚ã‚Šï¼ˆé€šå¸¸æ™‚ +10ï¼…ï¼‰</option>
          <option value="15">ã‚ã‚Šï¼ˆè‡³é«˜æ™‚ +15ï¼…ï¼‰</option>
        </select>
      </div>
      <div class="control-group">
        <label>ã‚¢ã‚°ãƒã‚¹ã‚¹ã‚­ãƒ« Lv</label>
        <select id="agnesLevel" class="wide">
          <option value="0">Lv0ï¼ˆãªã—ï¼‰</option>
          <option value="1">Lv1ï¼ˆ1æ®µéšã‚ãŸã‚Š2æ™‚é–“ï¼‰</option>
          <option value="2">Lv2ï¼ˆ1æ®µéšã‚ãŸã‚Š3æ™‚é–“ï¼‰</option>
          <option value="3">Lv3ï¼ˆ1æ®µéšã‚ãŸã‚Š4æ™‚é–“ï¼‰</option>
          <option value="4">Lv4ï¼ˆ1æ®µéšã‚ãŸã‚Š6æ™‚é–“ï¼‰</option>
          <option value="5">Lv5ï¼ˆ1æ®µéšã‚ãŸã‚Š8æ™‚é–“ï¼‰</option>
        </select>
      </div>
    </div>

    <div class="btn-row">
      <button id="calcBtn">è¨ˆç®—ã™ã‚‹</button>
    </div>

    <h2>â‘¢ çµæœ</h2>
    <div class="results">
      <div class="result-card">
        <div class="result-label">ç·ç²¾éŒ¬ç«æ™¶</div>
        <div class="result-value" id="totalRefine">-</div>
      </div>
      <div class="result-card">
        <div class="result-label">ç·ç«æ™¶</div>
        <div class="result-value" id="totalFire">-</div>
      </div>
      <div class="result-card">
        <div class="result-label">åŸºç¤å»ºé€ æ™‚é–“ åˆè¨ˆ</div>
        <div class="result-value" id="baseTime">-</div>
      </div>
      <div class="result-card">
        <div class="result-label">åŠ é€Ÿå¾Œ å»ºé€ æ™‚é–“ åˆè¨ˆ</div>
        <div class="result-value" id="boostedTime">-</div>
      </div>
      <div class="result-card">
        <div class="result-label">åˆè¨ˆåŠ é€Ÿç‡ï¼ˆï¼…åŠ é€Ÿåˆ†ï¼‰</div>
        <div class="result-value" id="accelInfo">-</div>
      </div>
    </div>

    <h2>â‘£ å»ºç‰©åˆ¥ å†…è¨³</h2>
    <table class="detail-table">
      <thead>
        <tr>
          <th>å»ºç‰©</th>
          <th>ç²¾éŒ¬ç«æ™¶</th>
          <th>ç«æ™¶</th>
          <th>åŸºç¤æ™‚é–“</th>
          <th>åŠ é€Ÿå¾Œæ™‚é–“ï¼ˆï¼…ï¼‹ã‚¢ã‚°ãƒã‚¹ï¼‰</th>
        </tr>
      </thead>
      <tbody id="detailBody">
        <tr><td colspan="5" style="color:var(--muted);">ã¾ã è¨ˆç®—ã—ã¦ã„ã¾ã›ã‚“ã€‚</td></tr>
      </tbody>
    </table>

    <div class="note">
      â€» æ™‚é–“ã¯ã€å„æ®µéšã”ã¨ã®ã€ŒåŸºç¤å»ºé€ æ™‚é–“ã€ã‚’åˆè¨ˆã—ã€<br>
      (100 ï¼‹ å»ºé€ åŠ é€Ÿ ï¼‹ é ˜ä¸»æŒ‡ä»¤ ï¼‹ ãƒšãƒƒãƒˆã‚¹ã‚­ãƒ« ï¼‹ åŸ·æ”¿å®˜ ï¼‹ å‰¯åŸ·æ”¿å®˜)ï¼… ã§å‰²åˆåŠ é€Ÿã—ãŸã‚ã¨ã€<br>
      ã‚¢ã‚°ãƒã‚¹ã‚¹ã‚­ãƒ«Lvã«å¿œã˜ã¦ã€Œ1æ®µéšã‚ãŸã‚Šã®å›ºå®šçŸ­ç¸®æ™‚é–“ Ã— ä¸Šã’ãŸæ®µéšæ•°ã€ã‚’æ®µéšã”ã¨ã«æ¸›ç®—ã—ã¦è¨ˆç®—ã—ã¦ã„ã¾ã™ã€‚<br>
    </div>
  </div>
</div>

<script>
const STAGES_PER_FC = 5;

function buildDaikou() {
  const rows = [];
  const push = (fc,sf,st,refine,fire,d,h,m,s) => {
    for (let stage = sf; stage <= st; stage++) {
      rows.push({fc, stage, refine, fire, d, h, m, s});
    }
  };
  push(0,0,4,0,132,7,0,0,0);
  push(1,0,4,0,158,9,0,0,0);
  push(2,0,4,0,238,11,0,0,0);
  push(3,0,4,0,280,12,0,0,0);
  push(4,0,4,0,335,14,0,0,0);
  push(5,0,3,10,200,15,0,0,0);
  push(5,4,4,20,100,15,0,0,0);
  push(6,0,3,15,240,18,0,0,0);
  push(6,4,4,30,120,18,0,0,0);
  push(7,0,3,20,240,20,0,0,0);
  push(7,4,4,40,120,20,0,0,0);
  return rows;
}

function buildTaishikan() {
  const rows = [];
  const push = (fc,sf,st,refine,fire,d,h,m,s) => {
    for (let stage = sf; stage <= st; stage++) {
      rows.push({fc, stage, refine, fire, d, h, m, s});
    }
  };
  push(0,0,4,0,33,4,14,52,0);
  push(1,0,4,0,39,5,22,33,0);
  push(2,0,4,0,59,7,6,14,0);
  push(3,0,4,0,70,7,22,4,0);
  push(4,0,4,0,83,9,5,45,0);
  push(5,0,3,2,50,9,21,36,0);
  push(5,4,4,5,25,9,21,36,0);
  push(6,0,3,3,60,11,21,7,0);
  push(6,4,4,7,30,11,21,7,0);
  push(7,0,3,5,60,13,4,48,0);
  push(7,4,4,11,30,13,4,48,0);
  return rows;
}

function buildShireibu() {
  const rows = [];
  const push = (fc,sf,st,refine,fire,d,h,m,s) => {
    for (let stage = sf; stage <= st; stage++) {
      rows.push({fc, stage, refine, fire, d, h, m, s});
    }
  };
  push(0,0,4,0,26,0,20,9,30);
  push(1,0,4,0,31,1,1,55,0);
  push(2,0,4,0,47,1,7,40,0);
  push(3,0,4,0,56,1,10,33,0);
  push(4,0,4,0,67,1,16,31,0);
  push(5,0,3,2,40,1,19,12,0);
  push(5,4,4,4,20,1,19,12,0);
  push(6,0,3,3,48,2,1,30,0);
  push(6,4,4,6,24,2,1,30,0);
  push(7,0,3,4,48,2,9,36,0);
  push(7,4,4,8,24,2,9,36,0);
  return rows;
}

function buildHeisha() {
  const rows = [];
  const push = (fc,sf,st,refine,fire,d,h,m,s) => {
    for (let stage = sf; stage <= st; stage++) {
      rows.push({fc, stage, refine, fire, d, h, m, s});
    }
  };
  push(0,0,4,0,59,1,1,12,0);
  push(1,0,4,0,71,1,8,24,0);
  push(2,0,4,0,107,1,15,36,0);
  push(3,0,4,0,126,1,19,12,0);
  push(4,0,4,0,150,2,2,24,0);
  push(5,0,3,4,90,2,6,0,0);
  push(5,4,4,9,45,2,6,0,0);
  push(6,0,3,6,108,2,16,48,0);
  push(6,4,4,13,54,2,16,48,0);
  push(7,0,3,9,108,3,0,0,0);
  push(7,4,4,18,54,3,0,0,0);
  return rows;
}

function buildGakuen() {
  const rows = [];
  const push = (fc,sf,st,refine,fire,d,h,m,s) => {
    for (let stage = sf; stage <= st; stage++) {
      rows.push({fc, stage, refine, fire, d, h, m, s});
    }
  };
  push(0,0,4,0,0,0,0,0,0);
  push(1,0,4,0,71,1,19,12,0);
  push(2,0,4,0,107,2,4,48,0);
  push(3,0,4,0,126,2,9,36,0);
  push(4,0,4,0,150,2,19,12,0);
  push(5,0,3,4,90,3,0,0,0);
  push(5,4,4,9,45,3,0,0,0);
  push(6,0,3,6,108,3,14,24,0);
  push(6,4,4,13,54,3,14,24,0);
  push(7,0,4,9,108,4,0,0,0);
  return rows;
}

const BASE_DATA = {
  "å¤§æº¶é‰±ç‚‰": buildDaikou(),
  "å¤§ä½¿é¤¨": buildTaishikan(),
  "å¸ä»¤éƒ¨": buildShireibu(),
  "å…µèˆ": buildHeisha(),
  "æˆ¦äº‰å­¦åœ’": buildGakuen(),
};

function idxFromFcStage(fc, stage) {
  return fc * STAGES_PER_FC + stage;
}

function rowToSeconds(row) {
  return (((row.d * 24 + row.h) * 60 + row.m) * 60 + row.s);
}

function secondsToText(sec) {
  if (sec <= 0) return "0ç§’";
  const days = Math.floor(sec / 86400);
  sec %= 86400;
  const hours = Math.floor(sec / 3600);
  sec %= 3600;
  const mins = Math.floor(sec / 60);
  const secs = sec % 60;
  let parts = [];
  if (days) parts.push(days + "æ—¥");
  if (hours || parts.length) parts.push(hours + "æ™‚é–“");
  if (mins || parts.length) parts.push(mins + "åˆ†");
  if (secs || parts.length === 0) parts.push(secs + "ç§’");
  return parts.join(" ");
}

function getPetBonus(level) {
  switch (level) {
    case 1: return 5;
    case 2: return 7;
    case 3: return 9;
    case 4: return 12;
    case 5: return 15;
    default: return 0;
  }
}

function getAgnesBonusHours(level) {
  switch (level) {
    case 1: return 2;
    case 2: return 3;
    case 3: return 4;
    case 4: return 6;
    case 5: return 8;
    default: return 0;
  }
}

// å»ºç‰©ã”ã¨ã®é›†è¨ˆï¼ˆï¼…åŠ é€Ÿï¼‹ã‚¢ã‚°ãƒã‚¹è¾¼ã¿ï¼‰
function calcBuilding(buildingName, fromFc, fromStage, toFc, toStage, totalAccelPercent, agnesLevel) {
  const dataKey = buildingName.includes("å…µèˆ") ? "å…µèˆ" : buildingName;
  const data = BASE_DATA[dataKey];
  if (!data) return { refine: 0, fire: 0, baseSec: 0, finalSec: 0 };

  const startIdx = idxFromFcStage(fromFc, fromStage);
  const endIdx = idxFromFcStage(toFc, toStage);

  if (endIdx <= startIdx) {
    return { refine: 0, fire: 0, baseSec: 0, finalSec: 0 };
  }

  const maxIdx = Math.min(endIdx, data.length);
  const agnesHours = getAgnesBonusHours(agnesLevel);
  const agnesCutPerStepSec = agnesHours * 3600;

  let refine = 0;
  let fire = 0;
  let baseSec = 0;
  let finalSec = 0;

  for (let i = startIdx; i < maxIdx; i++) {
    const row = data[i];
    const stepBase = rowToSeconds(row);

    refine += row.refine;
    fire += row.fire;
    baseSec += stepBase;

    // å‰²åˆåŠ é€Ÿå¾Œ
    let stepAfterPercent = totalAccelPercent > 0
      ? Math.floor(stepBase * 100 / (100 + totalAccelPercent))
      : stepBase;

    // ã‚¢ã‚°ãƒã‚¹å›ºå®šçŸ­ç¸®ï¼ˆ1æ®µéšã”ã¨ï¼‰
    if (agnesCutPerStepSec > 0) {
      stepAfterPercent = Math.max(0, stepAfterPercent - agnesCutPerStepSec);
    }

    finalSec += stepAfterPercent;
  }

  return { refine, fire, baseSec, finalSec };
}

(function initSelectors() {
  const fcOptions = [];
  for (let fc = 0; fc <= 8; fc++) {
    fcOptions.push(`<option value="${fc}">${fc}</option>`);
  }
  const stageOptions = [];
  for (let st = 0; st <= 4; st++) {
    stageOptions.push(`<option value="${st}">${st}</option>`);
  }

  document.querySelectorAll("#buildingRows tr").forEach((tr) => {
    tr.querySelectorAll(".from-fc, .to-fc").forEach(sel => {
      sel.innerHTML = fcOptions.join("");
    });
    tr.querySelectorAll(".from-stage, .to-stage").forEach(sel => {
      sel.innerHTML = stageOptions.join("");
    });
  });
})();

document.getElementById("calcBtn").addEventListener("click", () => {
  const tbody = document.getElementById("detailBody");
  tbody.innerHTML = "";

  let totalRefine = 0;
  let totalFire = 0;
  let totalBaseSec = 0;
  let totalFinalSec = 0;

  const baseAccel = Number(document.getElementById("baseAccel").value) || 0;
  const lordRadio = document.querySelector("input[name='lord']:checked");
  const lordBonus = lordRadio && lordRadio.value === "on" ? 20 : 0;
  const petLevel = Number(document.getElementById("petLevel").value) || 0;
  const petBonus = getPetBonus(petLevel);
  const govRadio = document.querySelector("input[name='governor']:checked");
  const govBonus = govRadio && govRadio.value === "on" ? 10 : 0;
  const subGovBonus = Number(document.getElementById("subGov").value) || 0;
  const agnesLevel = Number(document.getElementById("agnesLevel").value) || 0;

  const totalAccelPercent = baseAccel + lordBonus + petBonus + govBonus + subGovBonus;

  const rows = document.querySelectorAll("#buildingRows tr");
  const detailRows = [];

  rows.forEach((tr) => {
    const name = tr.dataset.building;
    const fromFc = Number(tr.querySelector(".from-fc").value);
    const fromStage = Number(tr.querySelector(".from-stage").value);
    const toFc = Number(tr.querySelector(".to-fc").value);
    const toStage = Number(tr.querySelector(".to-stage").value);

    const { refine, fire, baseSec, finalSec } =
      calcBuilding(name, fromFc, fromStage, toFc, toStage, totalAccelPercent, agnesLevel);

    if (baseSec > 0 || refine > 0 || fire > 0) {
      totalRefine += refine;
      totalFire += fire;
      totalBaseSec += baseSec;
      totalFinalSec += finalSec;

      detailRows.push(`
        <tr>
          <td>${name}</td>
          <td>${refine}</td>
          <td>${fire}</td>
          <td>${secondsToText(baseSec)}</td>
          <td>${secondsToText(finalSec)}</td>
        </tr>
      `);
    }
  });

  if (detailRows.length === 0) {
    tbody.innerHTML = `<tr><td colspan="5" style="color:var(--muted);">æœ‰åŠ¹ãªãƒ¬ãƒ™ãƒ«å·®ãŒã‚ã‚Šã¾ã›ã‚“ã€‚ï¼ˆç¾åœ¨ã¨ç›®æ¨™ãŒåŒã˜ï¼‰</td></tr>`;
  } else {
    tbody.innerHTML = detailRows.join("");
  }

  document.getElementById("totalRefine").textContent = totalRefine.toLocaleString();
  document.getElementById("totalFire").textContent = totalFire.toLocaleString();
  document.getElementById("baseTime").textContent = secondsToText(totalBaseSec);
  document.getElementById("boostedTime").textContent = secondsToText(totalFinalSec);
  document.getElementById("accelInfo").textContent =
    `${totalAccelPercent}%ï¼ˆå»ºé€ ${baseAccel}% ï¼‹ é ˜ä¸»${lordBonus}% ï¼‹ ãƒšãƒƒãƒˆ${petBonus}% ï¼‹ åŸ·æ”¿å®˜${govBonus}% ï¼‹ å‰¯åŸ·æ”¿å®˜${subGovBonus}%ï¼‰`;
});
</script>
</body>
</html>

